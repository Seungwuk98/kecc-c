// RUN: kecc-opt %s --canonicalize-constant --mem2reg | FileCheck %s

fun i32 @multi_block () {
// CHECK: fun i32 @multi_block ()
init:
  bid: b0
  allocations:
    %l0:i32:x
// CHECK-NEXT: init:
// CHECK-NEXT:   bid: b0
// CHECK-NEXT:   allocations:
// CHECK-NEXT:     %l0:i32:x

block b0:
// CHECK-LABEL: block b0:
  %b0:i0:i32 = load %l0:i32*
  // CHECK-NEXT: %b0:i0:unit = nop

  %b0:i1:unit = store 42:i32 %l0:i32*
  // CHECK-NEXT: %b0:i1:unit = nop
  %b0:i2:i32 = load %l0:i32*
  // CHECK-NEXT: %b0:i2:unit = nop

  %b0:i3:unit = store 37:i32 %l0:i32*
  // CHECK-NEXT: %b0:i3:unit = nop
  %b0:i4:i32 = load %l0:i32*
  // CHECK-NEXT: %b0:i4:unit = nop

  j b1()
  // CHECK-NEXT: j b1() 

block b1:
// CHECK-LABEL: block b1:
  %b1:i0:i32 = load %l0:i32*
  // CHECK-NEXT: %b1:i0:unit = nop

  %b1:i1:unit = call @sink:[ret:unit params:(i32)]*(%b0:i0:i32)
  // CHECK-NEXT: %b1:i1:unit = call @sink:[ret:unit params:(i32)]*(undef:i32)
  %b1:i2:unit = call @sink:[ret:unit params:(i32)]*(%b0:i2:i32)
  // CHECK-NEXT: %b1:i2:unit = call @sink:[ret:unit params:(i32)]*(42:i32)
  %b1:i3:unit = call @sink:[ret:unit params:(i32)]*(%b0:i4:i32)
  // CHECK-NEXT: %b1:i3:unit = call @sink:[ret:unit params:(i32)]*(37:i32)
  %b1:i4:unit = call @sink:[ret:unit params:(i32)]*(%b1:i0:i32)
  // CHECK-NEXT: %b1:i4:unit = call @sink:[ret:unit params:(i32)]*(37:i32)

  ret 0:i32
  // CHECK-NEXT: ret 0:i32
}
