// RUN: kecc-test-executor %s --dump-source=0 | kecc-translate | FileCheck %s


// CHECK: .globl load_small_int
// CHECK-NEXT: .align 1
// CHECK-NEXT: .type load_small_int, @function
fun i32 @load_small_int () {
// CHECK-NEXT: load_small_int
init:
  bid: b0
  allocations:

block b0:
// CHECK-LABEL: .load_small_int_L0:
  ret 15:i32
  // CHECK-NEXT: addiw a0,zero,15
  // CHECK-NEXT: ret
}


// CHECK: .globl load_small_int2
// CHECK-NEXT: .align 1
// CHECK-NEXT: .type load_small_int2, @function
fun i32 @load_small_int2 () {
// CHECK: load_small_int2
init:
  bid: b0
  allocations:

block b0:
// CHECK-LABEL: .load_small_int2
  ret 4095:i32
  // CHECK-NEXT: lui a0,1
  // CHECK-NEXT: addiw a0,a0,-1
  // CHECK-NEXT: ret
}


// CHECK: .globl load_big_shift
// CHECK-NEXT: .align 1
// CHECK-NEXT: .type load_big_shift, @function
fun u64 @load_big_shift () {
// CHECK-NEXT: load_big_shift:
init:
  bid: b0
  allocations:

block b0:
// CHECK-LABEL: .load_big_shift_L0:
  ret 18446744069414584320:u64 // ((1 << 32) - 1) << 32
  // CHECK-NEXT: addiw a0,zero,-1
  // CHECK-NEXT: slli  a0,a0,32
  // CHECK-NEXT: ret
}


// CHECK: .globl load_big_shift2
// CHECK-NEXT: .align 1
// CHECK-NEXT: .type load_big_shift2, @function
fun u64 @load_big_shift2 () {
// CHECK-NEXT: load_big_shift2:
init:
  bid: b0 
  allocations:

block b0:
// CHECK-LABEL: .load_big_shift2_L0:
  ret 281406257233920:u64 // (1 << 12) - 1 << 36
  // CHECK-NEXT: lui a0,1
  // CHECK-NEXT: addiw a0,a0,-1
  // CHECK-NEXT: slli a0,a0,36
  // CHECK-NEXT: ret
}

///////////// main.c

// RUN: kecc-test-executor %s | FileCheck %s --check-prefix=RESULT
// RESULT: load small int: 15
// RESULT: load small int2: 4095
// RESULT: load big shift: 18446744069414584320
// RESULT: load big shift2: 281406257233920

#include <stdio.h>

extern int load_small_int();
extern int load_small_int2();
extern unsigned long long load_big_shift();
extern unsigned long long load_big_shift2();

int main() {
  printf("load small int: %d\n", load_small_int());
  printf("load small int2: %d\n", load_small_int2());
  printf("load big shift: %llu\n", load_big_shift());
  printf("load big shift2: %llu\n", load_big_shift2());
  return 0; 
}
